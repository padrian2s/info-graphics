<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Info Graphics Hub</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400,0,0">
    <style>
        :root {
            --bg0: #070A12;
            --bg1: #0B1222;
            --card: rgba(15,26,51,.65);
            --card-hover: rgba(15,26,51,.85);
            --stroke: #1f2b4d;
            --text: #EAF0FF;
            --muted: #A8B3D6;
            --muted2: #7E8BB5;
            --good: #2EE59D;
            --warn: #FFCC66;
            --blue: #66A3FF;
            --vio: #B38CFF;
            --teal: #37D6FF;
            --shadow: 0 18px 60px rgba(0,0,0,.35);
            --radius: 16px;
            --radius-sm: 10px;
            --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; }

        body {
            font-family: var(--sans);
            color: var(--text);
            background:
                radial-gradient(1100px 700px at 20% 12%, rgba(102,163,255,.18), transparent 55%),
                radial-gradient(1000px 700px at 80% 20%, rgba(179,140,255,.14), transparent 60%),
                radial-gradient(1100px 800px at 50% 90%, rgba(46,229,157,.10), transparent 60%),
                linear-gradient(180deg, var(--bg0), var(--bg1) 55%, #070A12);
            background-attachment: fixed;
            min-height: 100vh;
            line-height: 1.5;
        }

        a { color: inherit; text-decoration: none; }

        .material-symbols-rounded {
            font-family: 'Material Symbols Rounded';
            font-weight: normal;
            font-style: normal;
            font-size: 1.25rem;
            line-height: 1;
            display: inline-flex;
            vertical-align: middle;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1180px;
            margin: 0 auto;
            padding: 28px 18px 80px;
        }

        /* Header */
        header {
            text-align: center;
            padding: 40px 20px 30px;
        }

        .logo-wrap {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: conic-gradient(from 200deg, var(--blue), var(--vio), var(--good), var(--teal), var(--blue));
            box-shadow: 0 0 0 1px rgba(255,255,255,.12) inset, 0 12px 30px rgba(0,0,0,.28);
            margin-bottom: 16px;
            position: relative;
        }

        .logo-wrap::after {
            content: "";
            position: absolute;
            inset: 10px;
            border-radius: 10px;
            background: rgba(7,10,18,.8);
        }

        .logo-wrap .material-symbols-rounded {
            font-size: 1.5rem;
            position: relative;
            z-index: 1;
        }

        header h1 {
            font-size: 2rem;
            font-weight: 780;
            letter-spacing: -.5px;
            margin-bottom: 8px;
        }

        header p {
            color: var(--muted);
            font-size: 1rem;
        }

        /* Top Bar / Controls */
        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 12px 16px;
            border: 1px solid var(--stroke);
            border-radius: 999px;
            background: linear-gradient(180deg, rgba(15,26,51,.75), rgba(15,26,51,.35));
            backdrop-filter: blur(12px);
            box-shadow: 0 18px 60px rgba(0,0,0,.22);
            position: sticky;
            top: 12px;
            z-index: 20;
            margin-bottom: 28px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-box .material-symbols-rounded {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--muted2);
            font-size: 1.1rem;
        }

        .search-box input {
            width: 100%;
            padding: 10px 14px 10px 42px;
            border: 1px solid rgba(255,255,255,.1);
            border-radius: 999px;
            font-size: 0.9rem;
            background: rgba(7,10,18,.4);
            color: var(--text);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .search-box input::placeholder {
            color: var(--muted2);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 3px rgba(102,163,255,.15);
        }

        .controls-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* View Switcher */
        .view-switcher {
            display: flex;
            gap: 2px;
            background: rgba(7,10,18,.4);
            padding: 4px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,.08);
        }

        .view-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 999px;
            background: transparent;
            color: var(--muted2);
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-btn:hover {
            color: var(--text);
        }

        .view-btn.active {
            background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
            color: var(--text);
            box-shadow: 0 2px 8px rgba(0,0,0,.2);
        }

        .view-btn .material-symbols-rounded {
            font-size: 1.1rem;
        }

        /* Filter Pills */
        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 8px 0;
        }

        .filter-btn {
            padding: 8px 14px;
            border: 1px solid rgba(255,255,255,.1);
            border-radius: 999px;
            background: rgba(7,10,18,.3);
            color: var(--muted);
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: rgba(255,255,255,.2);
            color: var(--text);
        }

        .filter-btn.active {
            background: linear-gradient(180deg, rgba(102,163,255,.25), rgba(102,163,255,.1));
            border-color: var(--blue);
            color: var(--text);
        }

        /* Category Sections */
        .category {
            margin-bottom: 36px;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--stroke);
        }

        .category-header .material-symbols-rounded {
            color: var(--blue);
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: 650;
        }

        .category-count {
            background: rgba(255,255,255,.08);
            padding: 2px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            color: var(--muted2);
        }

        /* Page Cards Grid */
        .pages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        .page-card {
            background: var(--card);
            border: 1px solid var(--stroke);
            border-radius: var(--radius);
            padding: 20px;
            transition: all 0.25s ease;
            display: block;
            position: relative;
            overflow: hidden;
        }

        .page-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(300px 150px at 10% 10%, rgba(102,163,255,.08), transparent 50%),
                radial-gradient(250px 150px at 90% 80%, rgba(179,140,255,.06), transparent 50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .page-card:hover {
            transform: translateY(-3px);
            border-color: rgba(102,163,255,.4);
            background: var(--card-hover);
            box-shadow: var(--shadow);
        }

        .page-card:hover::before {
            opacity: 1;
        }

        .page-card > * {
            position: relative;
        }

        .page-card h3 {
            font-size: 1rem;
            font-weight: 620;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            line-height: 1.3;
        }

        .page-card h3 .material-symbols-rounded {
            color: var(--good);
            font-size: 1.2rem;
        }

        .page-card p {
            color: var(--muted);
            font-size: 0.875rem;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .page-card .search-match {
            background: rgba(46,229,157,.08);
            border: 1px solid rgba(46,229,157,.2);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 12px;
            font-size: 0.8rem;
            color: var(--muted);
            line-height: 1.6;
        }

        .page-card .search-match mark {
            background: rgba(46,229,157,.25);
            color: var(--good);
            padding: 1px 4px;
            border-radius: 3px;
            font-weight: 500;
        }

        .page-card .search-match::before {
            content: "Match: ";
            color: var(--muted2);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .page-card .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tag {
            background: rgba(255,255,255,.06);
            border: 1px solid rgba(255,255,255,.08);
            padding: 3px 10px;
            border-radius: 999px;
            font-size: 0.7rem;
            color: var(--muted2);
        }

        .page-card .date {
            font-size: 0.75rem;
            color: var(--muted2);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .page-card .date .material-symbols-rounded {
            font-size: 0.9rem;
            color: var(--teal);
        }

        .page-card .category-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.7rem;
            color: var(--vio);
            background: rgba(179,140,255,.12);
            border: 1px solid rgba(179,140,255,.2);
            padding: 3px 10px;
            border-radius: 999px;
            margin-bottom: 10px;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 80px 20px;
            color: var(--muted);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--muted);
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 8px;
            color: var(--text);
        }

        /* Responsive */
        @media (max-width: 700px) {
            .container {
                padding: 16px 12px 60px;
            }

            header {
                padding: 24px 16px 20px;
            }

            header h1 {
                font-size: 1.5rem;
            }

            .topbar {
                padding: 10px 12px;
                border-radius: 20px;
                flex-direction: column;
                gap: 10px;
            }

            .search-box {
                width: 100%;
            }

            .controls-right {
                width: 100%;
                justify-content: center;
            }

            .filter-group {
                justify-content: center;
            }

            .pages-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Story Timeline View */
        .timeline-view {
            position: relative;
            padding-left: 40px;
        }

        .timeline-view::before {
            content: "";
            position: absolute;
            left: 14px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--teal), var(--vio), var(--blue));
            border-radius: 999px;
            opacity: 0.4;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
        }

        .timeline-node {
            position: absolute;
            left: -40px;
            top: 20px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--bg0);
            z-index: 2;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .timeline-item:hover .timeline-node {
            transform: scale(1.15);
            box-shadow: 0 0 20px currentColor;
        }

        /* Temperature colors */
        .temp-hot { background: linear-gradient(135deg, #ff6b6b, #ff8e53); color: #ff6b6b; }
        .temp-warm { background: linear-gradient(135deg, #ffd93d, #ff9f43); color: #ffd93d; }
        .temp-mild { background: linear-gradient(135deg, #6bcf7f, #4ecdc4); color: #6bcf7f; }
        .temp-cool { background: linear-gradient(135deg, #4ecdc4, #45b7d1); color: #4ecdc4; }
        .temp-cold { background: linear-gradient(135deg, #74b9ff, #a29bfe); color: #a29bfe; }

        .timeline-card {
            background: var(--card);
            border: 1px solid var(--stroke);
            border-radius: var(--radius);
            overflow: hidden;
            transition: all 0.25s ease;
        }

        .timeline-card:hover {
            transform: translateX(8px);
            border-color: rgba(102,163,255,.4);
            box-shadow: var(--shadow);
        }

        .timeline-card-header {
            padding: 16px 20px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 16px;
            cursor: pointer;
            user-select: none;
        }

        .timeline-card-header:hover {
            background: rgba(255,255,255,.02);
        }

        .timeline-card-main {
            flex: 1;
        }

        .timeline-card-main h3 {
            font-size: 1rem;
            font-weight: 620;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timeline-card-main h3 .material-symbols-rounded {
            color: var(--good);
            font-size: 1.1rem;
        }

        .timeline-card-main p {
            color: var(--muted);
            font-size: 0.85rem;
            line-height: 1.5;
            margin: 0;
        }

        .timeline-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .temp-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid currentColor;
            background: rgba(0,0,0,.2);
        }

        .temp-badge .material-symbols-rounded {
            font-size: 0.9rem;
        }

        .temp-hot .temp-badge { border-color: rgba(255,107,107,.4); }
        .temp-warm .temp-badge { border-color: rgba(255,217,61,.4); }
        .temp-mild .temp-badge { border-color: rgba(107,207,127,.4); }
        .temp-cool .temp-badge { border-color: rgba(78,205,196,.4); }
        .temp-cold .temp-badge { border-color: rgba(162,155,254,.4); }

        .date-badge {
            font-size: 0.75rem;
            color: var(--muted2);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .date-badge .material-symbols-rounded {
            font-size: 0.9rem;
            color: var(--teal);
        }

        .expand-btn {
            width: 32px;
            height: 32px;
            border-radius: 10px;
            border: 1px solid var(--stroke);
            background: rgba(0,0,0,.2);
            color: var(--muted);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .expand-btn:hover {
            background: rgba(255,255,255,.05);
            color: var(--text);
        }

        .expand-btn .material-symbols-rounded {
            font-size: 1.1rem;
            transition: transform 0.25s;
        }

        .timeline-card.expanded .expand-btn .material-symbols-rounded {
            transform: rotate(180deg);
        }

        /* Expandable content */
        .timeline-card-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.35s ease;
        }

        .timeline-card.expanded .timeline-card-body {
            max-height: 800px;
        }

        .timeline-card-inner {
            padding: 0 20px 20px;
            border-top: 1px solid var(--stroke);
        }

        .topic-cluster {
            margin-top: 16px;
        }

        .topic-cluster-title {
            font-size: 0.8rem;
            color: var(--muted2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .topic-cluster-title .material-symbols-rounded {
            font-size: 1rem;
            color: var(--vio);
        }

        .topic-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .topic-pill {
            padding: 8px 14px;
            border-radius: 12px;
            font-size: 0.8rem;
            background: rgba(179,140,255,.1);
            border: 1px solid rgba(179,140,255,.2);
            color: var(--vio);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .topic-pill:hover {
            background: rgba(179,140,255,.2);
            border-color: rgba(179,140,255,.4);
            transform: translateY(-2px);
        }

        .topic-pill .material-symbols-rounded {
            font-size: 0.9rem;
        }

        .related-pages {
            margin-top: 16px;
        }

        .related-title {
            font-size: 0.8rem;
            color: var(--muted2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .related-title .material-symbols-rounded {
            font-size: 1rem;
            color: var(--teal);
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .related-card {
            padding: 12px;
            border-radius: 12px;
            background: rgba(0,0,0,.2);
            border: 1px solid var(--stroke);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
            text-decoration: none;
        }

        .related-card:hover {
            background: rgba(255,255,255,.03);
            border-color: rgba(102,163,255,.3);
            transform: translateY(-2px);
        }

        .related-card .material-symbols-rounded {
            font-size: 1.1rem;
            color: var(--good);
        }

        .related-card span {
            font-size: 0.8rem;
            color: var(--text);
            line-height: 1.3;
        }

        .timeline-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        .timeline-action-btn {
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1px solid var(--stroke);
            background: rgba(0,0,0,.2);
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .timeline-action-btn:hover {
            background: linear-gradient(180deg, rgba(102,163,255,.2), rgba(102,163,255,.08));
            border-color: var(--blue);
        }

        .timeline-action-btn.primary {
            background: linear-gradient(180deg, rgba(46,229,157,.2), rgba(46,229,157,.08));
            border-color: rgba(46,229,157,.4);
        }

        .timeline-action-btn.primary:hover {
            background: linear-gradient(180deg, rgba(46,229,157,.3), rgba(46,229,157,.12));
        }

        .timeline-action-btn .material-symbols-rounded {
            font-size: 1rem;
        }

        /* Temperature legend */
        .temp-legend {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            background: rgba(0,0,0,.2);
            border: 1px solid var(--stroke);
            border-radius: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .temp-legend-title {
            font-size: 0.8rem;
            color: var(--muted2);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .temp-legend-title .material-symbols-rounded {
            font-size: 1rem;
        }

        .temp-legend-items {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .temp-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: var(--muted);
        }

        .temp-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .temp-legend-dot.hot { background: linear-gradient(135deg, #ff6b6b, #ff8e53); }
        .temp-legend-dot.warm { background: linear-gradient(135deg, #ffd93d, #ff9f43); }
        .temp-legend-dot.mild { background: linear-gradient(135deg, #6bcf7f, #4ecdc4); }
        .temp-legend-dot.cool { background: linear-gradient(135deg, #4ecdc4, #45b7d1); }
        .temp-legend-dot.cold { background: linear-gradient(135deg, #74b9ff, #a29bfe); }

        /* Mindmap styles */
        .mindmap-container {
            padding: 20px;
            background: rgba(0,0,0,.15);
            border: 1px solid var(--stroke);
            border-radius: var(--radius);
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        .mindmap-center {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(102,163,255,.3), rgba(179,140,255,.3));
            border: 2px solid rgba(255,255,255,.2);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 4px;
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mindmap-center:hover {
            transform: translate(-50%, -50%) scale(1.08);
            box-shadow: 0 0 40px rgba(102,163,255,.3);
        }

        .mindmap-center .material-symbols-rounded {
            font-size: 1.5rem;
            color: var(--text);
        }

        .mindmap-center span {
            font-size: 0.75rem;
            color: var(--muted);
            text-align: center;
        }

        .mindmap-branch {
            position: absolute;
            padding: 12px 16px;
            border-radius: 12px;
            background: var(--card);
            border: 1px solid var(--stroke);
            cursor: pointer;
            transition: all 0.25s;
            max-width: 180px;
        }

        .mindmap-branch:hover {
            transform: scale(1.05);
            border-color: rgba(102,163,255,.5);
            box-shadow: var(--shadow);
            z-index: 20;
        }

        .mindmap-branch h4 {
            font-size: 0.85rem;
            margin: 0 0 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .mindmap-branch h4 .material-symbols-rounded {
            font-size: 1rem;
        }

        .mindmap-branch .count {
            font-size: 0.7rem;
            color: var(--muted2);
        }

        .mindmap-line {
            position: absolute;
            background: linear-gradient(90deg, rgba(102,163,255,.3), rgba(179,140,255,.3));
            height: 2px;
            transform-origin: left center;
            pointer-events: none;
        }

        /* Reels/TikTok Style View */
        .reels-container {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: var(--bg0);
            overflow: hidden;
        }

        .reels-scroll {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .reels-scroll::-webkit-scrollbar {
            display: none;
        }

        .reel-card {
            height: 100vh;
            height: 100dvh;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
        }

        .reel-card::before {
            content: "";
            position: absolute;
            inset: 0;
            opacity: 0.6;
            pointer-events: none;
        }

        .reel-card:nth-child(6n+1)::before {
            background: radial-gradient(circle at 30% 20%, rgba(102,163,255,.4), transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(179,140,255,.3), transparent 50%);
        }
        .reel-card:nth-child(6n+2)::before {
            background: radial-gradient(circle at 70% 30%, rgba(46,229,157,.4), transparent 50%),
                        radial-gradient(circle at 30% 70%, rgba(55,214,255,.3), transparent 50%);
        }
        .reel-card:nth-child(6n+3)::before {
            background: radial-gradient(circle at 50% 20%, rgba(255,107,107,.35), transparent 50%),
                        radial-gradient(circle at 50% 80%, rgba(255,204,102,.3), transparent 50%);
        }
        .reel-card:nth-child(6n+4)::before {
            background: radial-gradient(circle at 20% 50%, rgba(179,140,255,.4), transparent 50%),
                        radial-gradient(circle at 80% 50%, rgba(102,163,255,.3), transparent 50%);
        }
        .reel-card:nth-child(6n+5)::before {
            background: radial-gradient(circle at 80% 20%, rgba(55,214,255,.4), transparent 50%),
                        radial-gradient(circle at 20% 80%, rgba(46,229,157,.3), transparent 50%);
        }
        .reel-card:nth-child(6n)::before {
            background: radial-gradient(circle at 50% 30%, rgba(255,204,102,.4), transparent 50%),
                        radial-gradient(circle at 50% 70%, rgba(179,140,255,.3), transparent 50%);
        }

        .reel-content {
            position: relative;
            z-index: 2;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .reel-category {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 999px;
            background: rgba(255,255,255,.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,.15);
            font-size: 0.8rem;
            color: var(--text);
            margin-bottom: 20px;
        }

        .reel-category .material-symbols-rounded {
            font-size: 1rem;
        }

        .reel-title {
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 20px;
            letter-spacing: -0.02em;
            text-shadow: 0 4px 30px rgba(0,0,0,.5);
        }

        .reel-highlight {
            font-size: clamp(3rem, 10vw, 5rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--teal), var(--vio));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 24px 0;
            line-height: 1;
            text-shadow: none;
        }

        .reel-description {
            font-size: 1rem;
            color: var(--muted);
            line-height: 1.6;
            margin-bottom: 24px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .reel-quote {
            font-size: 1.1rem;
            font-style: italic;
            color: var(--text);
            line-height: 1.5;
            padding: 20px 24px;
            background: rgba(0,0,0,.3);
            border-left: 3px solid var(--teal);
            border-radius: 0 12px 12px 0;
            margin: 24px 0;
            text-align: left;
        }

        .reel-quote-author {
            font-size: 0.85rem;
            color: var(--muted2);
            font-style: normal;
            margin-top: 10px;
        }

        .reel-stats {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin: 24px 0;
        }

        .reel-stat {
            text-align: center;
        }

        .reel-stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--teal);
        }

        .reel-stat-label {
            font-size: 0.75rem;
            color: var(--muted2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Decorative floating icons with entropy support */
        .reels-container {
            --entropy: 0;
            --entropy-scale: 1;
            --entropy-rotation: 0deg;
            --entropy-hue: 0deg;
        }

        .reel-deco {
            position: absolute;
            z-index: 1;
            opacity: calc(0.08 + var(--entropy) * 0.15);
            pointer-events: none;
            animation: float 8s ease-in-out infinite;
            transition: opacity 0.3s, filter 0.3s;
            filter: hue-rotate(var(--entropy-hue)) blur(calc(var(--entropy) * 2px));
        }

        .reel-deco .material-symbols-rounded {
            font-size: calc(80px + var(--entropy) * 40px);
            color: #fff;
            transition: font-size 0.3s;
        }

        .reel-deco-1 {
            top: 10%;
            right: 8%;
            animation-delay: 0s;
            animation-duration: calc(8s - var(--entropy) * 5s);
        }

        .reel-deco-2 {
            bottom: 20%;
            left: 5%;
            animation-delay: -2.5s;
            animation-duration: calc(8s - var(--entropy) * 4s);
        }

        .reel-deco-3 {
            top: 50%;
            right: 15%;
            animation-delay: -5s;
            animation-duration: calc(8s - var(--entropy) * 6s);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(var(--entropy-scale)); }
            25% { transform: translateY(calc(-10px - var(--entropy) * 30px)) rotate(calc(5deg + var(--entropy-rotation))) scale(var(--entropy-scale)); }
            50% { transform: translateY(calc(-20px - var(--entropy) * 20px)) rotate(calc(0deg - var(--entropy-rotation) * 0.5)) scale(var(--entropy-scale)); }
            75% { transform: translateY(calc(-5px - var(--entropy) * 25px)) rotate(calc(-3deg + var(--entropy-rotation) * 0.7)) scale(var(--entropy-scale)); }
        }

        /* Entropy visual effects */
        .reel-card {
            transition: filter 0.2s;
        }

        .reels-container.entropy-low .reel-card::before {
            animation-duration: 20s;
        }

        .reels-container.entropy-medium .reel-card::before {
            animation-duration: 10s;
        }

        .reels-container.entropy-high .reel-card::before {
            animation-duration: 4s;
        }

        .reels-container.entropy-extreme .reel-card::before {
            animation-duration: 2s;
        }

        .reels-container.entropy-extreme .reel-deco {
            animation: float-chaos 1s ease-in-out infinite;
        }

        @keyframes float-chaos {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
            20% { transform: translateY(-30px) rotate(15deg) scale(1.2); }
            40% { transform: translateY(10px) rotate(-10deg) scale(0.9); }
            60% { transform: translateY(-20px) rotate(8deg) scale(1.1); }
            80% { transform: translateY(5px) rotate(-5deg) scale(1.05); }
        }

        /* Entropy indicator */
        .entropy-meter {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1002;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            border-radius: 999px;
            background: rgba(0,0,0,.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,.1);
            font-size: 0.75rem;
            color: var(--muted);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .entropy-meter.visible {
            opacity: 1;
        }

        .entropy-meter .material-symbols-rounded {
            font-size: 1.1rem;
            transition: color 0.2s;
        }

        .entropy-meter.level-low .material-symbols-rounded { color: var(--good); }
        .entropy-meter.level-medium .material-symbols-rounded { color: var(--teal); }
        .entropy-meter.level-high .material-symbols-rounded { color: var(--warn); }
        .entropy-meter.level-extreme .material-symbols-rounded { color: var(--bad); }

        .entropy-bar {
            width: 60px;
            height: 4px;
            border-radius: 2px;
            background: rgba(255,255,255,.1);
            overflow: hidden;
        }

        .entropy-fill {
            height: 100%;
            border-radius: 2px;
            background: var(--teal);
            transition: width 0.15s, background 0.2s;
        }

        .entropy-meter.level-low .entropy-fill { background: var(--good); }
        .entropy-meter.level-medium .entropy-fill { background: var(--teal); }
        .entropy-meter.level-high .entropy-fill { background: var(--warn); }
        .entropy-meter.level-extreme .entropy-fill { background: linear-gradient(90deg, var(--warn), var(--bad)); }

        /* Layout variant specific styles */
        .layout-center {
            text-align: center;
        }

        .layout-left {
            text-align: left;
            padding-left: 20px;
        }

        .layout-left .reel-stats {
            justify-content: flex-start;
        }

        .layout-left .reel-big-icon {
            position: absolute;
            top: -40px;
            right: -20px;
            opacity: 0.1;
        }

        .layout-left .reel-big-icon .material-symbols-rounded {
            font-size: 200px;
        }

        .layout-right {
            text-align: right;
            padding-right: 20px;
        }

        .layout-right .reel-stats {
            justify-content: flex-end;
        }

        .layout-stats-top .reel-stats-large {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(255,255,255,.1);
        }

        .layout-stats-top .reel-stats-large .reel-stat-value {
            font-size: 2.5rem;
        }

        .layout-split {
            display: flex;
            gap: 30px;
            text-align: left;
            align-items: center;
        }

        .reel-split-icons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            background: rgba(255,255,255,.05);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,.1);
        }

        .reel-split-icons .material-symbols-rounded {
            font-size: 32px;
            color: var(--teal);
            opacity: 0.8;
        }

        .reel-split-content {
            flex: 1;
        }

        .reel-split-content .reel-stats {
            justify-content: flex-start;
        }

        /* Variant-specific background tweaks */
        .layout-variant-1 .reel-deco-1 { top: 5%; left: 10%; right: auto; }
        .layout-variant-1 .reel-deco-2 { bottom: 10%; right: 10%; left: auto; }

        .layout-variant-2 .reel-deco-1 { top: 60%; }
        .layout-variant-2 .reel-deco-2 { bottom: 5%; }

        .layout-variant-3 .reel-deco-1 { left: 10%; right: auto; }
        .layout-variant-3 .reel-deco-3 { left: 20%; right: auto; }

        .layout-variant-4 .reel-deco { display: none; }

        /* Reels sidebar */
        .reels-sidebar {
            position: fixed;
            right: 20px;
            bottom: 50%;
            transform: translateY(50%);
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .reels-sidebar-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(255,255,255,.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,.15);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
        }

        .reels-sidebar-btn:hover {
            background: rgba(255,255,255,.2);
            transform: scale(1.1);
        }

        .reels-sidebar-btn .material-symbols-rounded {
            font-size: 1.3rem;
        }

        .reels-sidebar-btn.active {
            background: linear-gradient(135deg, rgba(255,107,107,.8), rgba(255,140,83,.8));
        }

        /* Close button */
        .reels-close {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1002;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(0,0,0,.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,.15);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
        }

        .reels-close:hover {
            background: rgba(255,255,255,.2);
            transform: scale(1.1);
        }

        /* Swipe hint */
        .reels-hint {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: var(--muted2);
            font-size: 0.8rem;
            animation: bounce 2s infinite;
            pointer-events: none;
        }

        .reels-hint .material-symbols-rounded {
            font-size: 1.5rem;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        /* Temperature badge in reels */
        .reel-temp {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 3;
        }

        .reel-temp.temp-hot { background: rgba(255,107,107,.2); color: #ff6b6b; border: 1px solid rgba(255,107,107,.3); }
        .reel-temp.temp-warm { background: rgba(255,217,61,.2); color: #ffd93d; border: 1px solid rgba(255,217,61,.3); }
        .reel-temp.temp-mild { background: rgba(107,207,127,.2); color: #6bcf7f; border: 1px solid rgba(107,207,127,.3); }
        .reel-temp.temp-cool { background: rgba(78,205,196,.2); color: #4ecdc4; border: 1px solid rgba(78,205,196,.3); }
        .reel-temp.temp-cold { background: rgba(162,155,254,.2); color: #a29bfe; border: 1px solid rgba(162,155,254,.3); }

        @media (max-width: 600px) {
            .reels-sidebar {
                right: 10px;
                gap: 14px;
            }
            .reels-sidebar-btn {
                width: 40px;
                height: 40px;
            }
            .reel-content {
                padding: 0 10px;
            }
            .reel-title {
                font-size: 1.6rem;
            }
            .reel-highlight {
                font-size: 2.5rem;
            }
        }

        /* Folder Cards */
        .folder-card {
            background: linear-gradient(180deg, rgba(15,26,51,.85), rgba(15,26,51,.55));
            border: 1px solid var(--stroke);
            border-radius: var(--radius);
            padding: 0;
            transition: all 0.25s ease;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .folder-card .folder-preview {
            width: 100%;
            height: 160px;
            overflow: hidden;
            position: relative;
            background: rgba(7,10,18,.5);
        }

        .folder-card .folder-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .folder-card:hover .folder-preview img {
            transform: scale(1.05);
        }

        .folder-card .folder-preview-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, transparent 40%, rgba(7,10,18,.8) 100%);
            pointer-events: none;
        }

        .folder-card .folder-content {
            padding: 20px;
        }

        .folder-card .folder-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .folder-card .folder-header h3 {
            margin: 0;
        }

        .folder-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(400px 200px at 0% 0%, rgba(255,204,102,.12), transparent 50%),
                radial-gradient(300px 150px at 100% 100%, rgba(179,140,255,.1), transparent 50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .folder-card:hover {
            transform: translateY(-4px);
            border-color: rgba(255,204,102,.5);
            box-shadow: 0 20px 60px rgba(0,0,0,.4);
        }

        .folder-card:hover::before {
            opacity: 1;
        }

        .folder-card > * {
            position: relative;
        }

        .folder-card .folder-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(255,204,102,.2), rgba(255,204,102,.08));
            border: 1px solid rgba(255,204,102,.25);
            flex-shrink: 0;
        }

        .folder-card .folder-icon .material-symbols-rounded {
            font-size: 1.25rem;
            color: var(--warn);
        }

        .folder-card h3 {
            font-size: 1.15rem;
            font-weight: 650;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .folder-card .folder-desc {
            color: var(--muted);
            font-size: 0.875rem;
            margin-bottom: 16px;
            line-height: 1.55;
        }

        .folder-card .folder-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .folder-card .folder-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--muted2);
        }

        .folder-card .folder-stat .material-symbols-rounded {
            font-size: 1rem;
            color: var(--teal);
        }

        .folder-card .folder-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
        }

        .folder-card .search-match {
            background: rgba(46,229,157,.08);
            border: 1px solid rgba(46,229,157,.2);
            border-radius: 8px;
            padding: 10px 12px;
            margin-top: 12px;
            font-size: 0.8rem;
            color: var(--muted);
            line-height: 1.6;
        }

        .folder-card .search-match mark {
            background: rgba(46,229,157,.25);
            color: var(--good);
            padding: 1px 4px;
            border-radius: 3px;
            font-weight: 500;
        }

        .folder-card .search-match::before {
            content: "Match in collection: ";
            color: var(--muted2);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .folders-section {
            margin-bottom: 32px;
        }

        .folders-section .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--stroke);
        }

        .folders-section .section-header .material-symbols-rounded {
            color: var(--warn);
        }

        .folders-section .section-title {
            font-size: 1.1rem;
            font-weight: 650;
        }

        .folders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 16px;
        }

        @media (max-width: 700px) {
            .folders-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-wrap">
                <span class="material-symbols-rounded" aria-hidden="true">bar_chart</span>
            </div>
            <h1>Info Graphics Hub</h1>
            <p>Essential AI intel, compressed for humans with no time</p>
        </header>

        <div class="topbar">
            <div class="search-box">
                <span class="material-symbols-rounded" aria-hidden="true">search</span>
                <input type="text" id="search" placeholder="Search pages..." autocomplete="off">
            </div>
            <div class="controls-right">
                <div class="view-switcher" id="viewSwitcher">
                    <button class="view-btn" data-view="folder" title="Folders">
                        <span class="material-symbols-rounded">folder_open</span>
                    </button>
                    <button class="view-btn" data-view="reels" title="Reels Mode">
                        <span class="material-symbols-rounded">play_circle</span>
                    </button>
                    <button class="view-btn" data-view="timeline" title="Story Timeline">
                        <span class="material-symbols-rounded">timeline</span>
                    </button>
                    <button class="view-btn" data-view="category" title="By Category">
                        <span class="material-symbols-rounded">category</span>
                    </button>
                    <button class="view-btn active" data-view="date" title="By Date">
                        <span class="material-symbols-rounded">calendar_month</span>
                    </button>
                    <button class="view-btn" data-view="grid" title="Grid View">
                        <span class="material-symbols-rounded">grid_view</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="filter-group" id="filters">
            <button class="filter-btn active" data-category="all">All</button>
        </div>

        <main id="content">
            <div class="loading">Loading pages...</div>
        </main>
    </div>

    <script>
        /**
         * HTML FILES LIST
         */
        const htmlFiles = [
            "2026_AI_Strategy_Comparison.html",
            "2026-bets-from-zach.html",
            "2026-brain2.html",
            "2026-predictions.html",
            "agents-domain-memory.html",
            "ai-factory-era.html",
            "ai-native-execution-cheap.html",
            "ai-strategy.html",
            "ai-strategy2.html",
            "ai-talent-market.html",
            "claude.html",
            "good-4-ai.html",
            "google-vs-openai.html",
            "healthcare-race.html",
            "llm-psy.html",
            "napoleon-technique.html",
            "personal-agents.html",
            "engineering-mode-trigger-levels.html",
            "human-friction.html",
            "latent-demand-ai.html"
        ];

        /**
         * FOLDERS LIST - each folder has its own index.html
         */
        let folders = [
            {
                id: "social-ai",
                name: "Social AI",
                path: "social-ai/",
                description: "Global AI & Prompt Engineering Readiness Reports - Interactive infographics analyzing country readiness for AI coding agents.",
                icon: "public",
                tags: ["Interactive", "Reports", "Global Analysis"],
                fileCount: 8,
                image: "image_5.png",
                files: [
                    "social-ai/Global_Readiness.html",
                    "social-ai/global-ai-readiness-report.html",
                    "social-ai/india.html",
                    "social-ai/italy.html",
                    "social-ai/romania.html",
                    "social-ai/spain.html",
                    "social-ai/world-ai-simulator.html"
                ],
                textContent: "" // Will be populated on load
            }
        ];

        const categoryMeta = {
            "AI Strategy": { icon: "architecture", order: 1 },
            "AI Agents": { icon: "smart_toy", order: 2 },
            "AI Principles": { icon: "check_circle", order: 3 },
            "AI Risks": { icon: "warning", order: 4 },
            "Future Predictions": { icon: "auto_awesome", order: 5 },
            "Industry Analysis": { icon: "factory", order: 6 },
            "Tools": { icon: "construction", order: 7 },
            "Documentation": { icon: "menu_book", order: 10 },
            "Data Visualization": { icon: "bar_chart", order: 11 },
            "Reports": { icon: "analytics", order: 12 },
            "Reference": { icon: "library_books", order: 14 },
            "Uncategorized": { icon: "folder", order: 50 },
            "Archive": { icon: "inventory_2", order: 99 }
        };

        const iconMap = {
            "": "psychology",
            "": "auto_awesome",
            "": "smart_toy",
            "": "factory",
            "": "architecture",
            "": "track_changes",
            "": "menu_book",
            "": "bar_chart",
            "": "show_chart",
            "": "check_circle",
            "": "hourglass_empty",
            "": "person",
            "": "warning",
            "": "construction"
        };

        // State
        let pages = [];
        let activeCategory = "all";
        let searchQuery = "";
        let currentView = "date";

        function extractMeta(html, name) {
            const match = html.match(new RegExp(`<meta\\s+name="${name}"\\s+content="([^"]*)"`, 'i'));
            return match ? match[1] : "";
        }

        function extractTitle(html) {
            const match = html.match(/<title>([^<]*)<\/title>/i);
            return match ? match[1] : "Untitled";
        }

        function extractTextContent(html) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            doc.querySelectorAll('script, style').forEach(el => el.remove());
            return doc.body ? doc.body.textContent.replace(/\s+/g, ' ').trim() : "";
        }

        function getSearchSnippet(text, query, contextChars = 60) {
            if (!query || !text) return null;
            const lowerText = text.toLowerCase();
            const lowerQuery = query.toLowerCase();
            const index = lowerText.indexOf(lowerQuery);
            if (index === -1) return null;

            // Find word boundaries for cleaner snippets
            let start = Math.max(0, index - contextChars);
            let end = Math.min(text.length, index + query.length + contextChars);

            // Extend to word boundaries
            if (start > 0) {
                const spaceIndex = text.lastIndexOf(' ', start + 10);
                if (spaceIndex > start - 20) start = spaceIndex + 1;
            }
            if (end < text.length) {
                const spaceIndex = text.indexOf(' ', end - 10);
                if (spaceIndex !== -1 && spaceIndex < end + 20) end = spaceIndex;
            }

            let snippet = text.slice(start, end);
            if (start > 0) snippet = '...' + snippet;
            if (end < text.length) snippet = snippet + '...';

            // Highlight all matches (case insensitive)
            const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            snippet = snippet.replace(regex, '<mark>$1</mark>');

            return snippet;
        }

        async function fetchPageMeta(filename, order) {
            try {
                const response = await fetch(filename);
                if (!response.ok) return null;

                const html = await response.text();
                const id = filename.replace('.html', '').toLowerCase();
                const tags = extractMeta(html, 'tags');
                const rawIcon = extractMeta(html, 'icon');
                const resolvedIcon = iconMap[rawIcon] || "description";

                const dateStr = extractMeta(html, 'created');
                const createdDate = dateStr ? new Date(dateStr) : null;

                return {
                    id,
                    title: extractTitle(html),
                    description: extractMeta(html, 'description'),
                    href: filename,
                    category: extractMeta(html, 'category') || "Uncategorized",
                    tags: tags ? tags.split(',').map(t => t.trim()) : [],
                    icon: resolvedIcon,
                    order,
                    textContent: extractTextContent(html),
                    created: createdDate,
                    createdStr: dateStr || null
                };
            } catch (e) {
                console.error(`Failed to load ${filename}:`, e);
                return null;
            }
        }

        async function loadFolderContents() {
            for (const folder of folders) {
                if (!folder.files || folder.files.length === 0) continue;

                const contentPromises = folder.files.map(async (file) => {
                    try {
                        const response = await fetch(file);
                        if (!response.ok) return "";
                        const html = await response.text();
                        return extractTextContent(html);
                    } catch (e) {
                        console.error(`Failed to load folder file ${file}:`, e);
                        return "";
                    }
                });

                const contents = await Promise.all(contentPromises);
                folder.textContent = contents.join(" ");
            }
        }

        async function loadPages() {
            const results = await Promise.all(htmlFiles.map((filename, index) => fetchPageMeta(filename, index)));
            pages = results.filter(p => p !== null).sort((a, b) => a.order - b.order);
            await loadFolderContents();
            initFilters();
            render();
        }

        function getCategories() {
            const cats = [...new Set(pages.map(p => p.category))];
            return cats.sort((a, b) => {
                const orderA = categoryMeta[a]?.order || 50;
                const orderB = categoryMeta[b]?.order || 50;
                return orderA - orderB;
            });
        }

        function initFilters() {
            const container = document.getElementById("filters");
            const allBtn = container.querySelector('[data-category="all"]');
            container.innerHTML = '';
            container.appendChild(allBtn);

            getCategories().forEach(cat => {
                const btn = document.createElement("button");
                btn.className = "filter-btn";
                btn.dataset.category = cat;
                btn.textContent = cat;
                container.appendChild(btn);
            });
        }

        function filterPages() {
            const query = searchQuery.toLowerCase().trim();

            return pages.filter(page => {
                if (activeCategory !== "all" && page.category !== activeCategory) {
                    return false;
                }

                if (query) {
                    const searchable = [
                        page.title,
                        page.description,
                        page.category,
                        ...page.tags,
                        page.textContent
                    ].join(" ").toLowerCase();
                    return searchable.includes(query);
                }

                return true;
            });
        }

        function groupByCategory(pageList) {
            const groups = {};
            pageList.forEach(page => {
                if (!groups[page.category]) groups[page.category] = [];
                groups[page.category].push(page);
            });
            return groups;
        }

        function formatDate(date) {
            if (!date) return null;
            return date.toLocaleDateString('ro-RO', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function renderCard(page, options = {}) {
            const { showDate = false, showCategoryBadge = false } = options;
            const dateHtml = showDate && page.created
                ? `<div class="date"><span class="material-symbols-rounded">calendar_month</span>${formatDate(page.created)}</div>`
                : '';
            const categoryBadgeHtml = showCategoryBadge
                ? `<span class="category-badge">${page.category}</span>`
                : '';

            // Generate search match snippet if searching
            let searchMatchHtml = '';
            if (searchQuery.trim()) {
                const snippet = getSearchSnippet(page.textContent, searchQuery.trim());
                if (snippet) {
                    searchMatchHtml = `<div class="search-match">${snippet}</div>`;
                }
            }

            return `
                <a href="${page.href}" class="page-card">
                    <h3><span class="material-symbols-rounded" aria-hidden="true">${page.icon}</span> ${page.title}</h3>
                    ${dateHtml}
                    ${categoryBadgeHtml}
                    <p>${page.description}</p>
                    ${searchMatchHtml}
                    <div class="tags">
                        ${page.tags.map(t => `<span class="tag">${t}</span>`).join("")}
                    </div>
                </a>
            `;
        }

        function renderCategoryView(filtered) {
            const grouped = groupByCategory(filtered);
            const categories = Object.keys(grouped).sort((a, b) => {
                const orderA = categoryMeta[a]?.order || 50;
                const orderB = categoryMeta[b]?.order || 50;
                return orderA - orderB;
            });

            return categories.map(cat => {
                const meta = categoryMeta[cat] || { icon: "folder" };
                return `
                    <section class="category">
                        <div class="category-header">
                            <span class="material-symbols-rounded" aria-hidden="true">${meta.icon}</span>
                            <h2 class="category-title">${cat}</h2>
                            <span class="category-count">${grouped[cat].length}</span>
                        </div>
                        <div class="pages-grid">
                            ${grouped[cat].map(p => renderCard(p)).join("")}
                        </div>
                    </section>
                `;
            }).join("");
        }

        function renderDateView(filtered) {
            const sorted = [...filtered].sort((a, b) => {
                if (a.created && b.created) return b.created - a.created;
                if (a.created) return -1;
                if (b.created) return 1;
                return a.order - b.order;
            });

            return `
                <div class="pages-grid">
                    ${sorted.map(p => renderCard(p, { showDate: true, showCategoryBadge: true })).join("")}
                </div>
            `;
        }

        function renderGridView(filtered) {
            const sorted = [...filtered].sort((a, b) => a.order - b.order);
            return `
                <div class="pages-grid">
                    ${sorted.map(p => renderCard(p, { showCategoryBadge: true })).join("")}
                </div>
            `;
        }

        function getTemperature(page) {
            if (!page.created) return { class: 'temp-cold', label: 'Archive', icon: 'ac_unit', days: null };

            const now = new Date();
            const diffTime = Math.abs(now - page.created);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays <= 7) return { class: 'temp-hot', label: 'Fresh', icon: 'local_fire_department', days: diffDays };
            if (diffDays <= 30) return { class: 'temp-warm', label: 'Recent', icon: 'whatshot', days: diffDays };
            if (diffDays <= 90) return { class: 'temp-mild', label: 'Current', icon: 'wb_sunny', days: diffDays };
            if (diffDays <= 180) return { class: 'temp-cool', label: 'Settling', icon: 'air', days: diffDays };
            return { class: 'temp-cold', label: 'Archive', icon: 'ac_unit', days: diffDays };
        }

        function getRelatedPages(page, allPages) {
            const related = [];
            const pageTags = page.tags.map(t => t.toLowerCase());

            allPages.forEach(p => {
                if (p.id === page.id) return;

                let score = 0;
                // Same category
                if (p.category === page.category) score += 2;
                // Shared tags
                const pTags = p.tags.map(t => t.toLowerCase());
                const sharedTags = pageTags.filter(t => pTags.includes(t));
                score += sharedTags.length * 3;

                if (score > 0) {
                    related.push({ page: p, score });
                }
            });

            return related
                .sort((a, b) => b.score - a.score)
                .slice(0, 4)
                .map(r => r.page);
        }

        function getAllTopics(pages) {
            const topicMap = {};
            pages.forEach(page => {
                page.tags.forEach(tag => {
                    const key = tag.toLowerCase();
                    if (!topicMap[key]) {
                        topicMap[key] = { name: tag, count: 0, pages: [] };
                    }
                    topicMap[key].count++;
                    topicMap[key].pages.push(page);
                });
            });
            return Object.values(topicMap).sort((a, b) => b.count - a.count);
        }

        function renderTimelineCard(page, allPages) {
            const temp = getTemperature(page);
            const related = getRelatedPages(page, allPages);
            const dateStr = page.created ? formatDate(page.created) : 'No date';
            const daysAgo = temp.days ? `${temp.days}d ago` : '';

            return `
                <div class="timeline-item">
                    <div class="timeline-node ${temp.class}"></div>
                    <div class="timeline-card" data-page-id="${page.id}">
                        <div class="timeline-card-header" onclick="toggleTimelineCard('${page.id}')">
                            <div class="timeline-card-main">
                                <h3>
                                    <span class="material-symbols-rounded" aria-hidden="true">${page.icon}</span>
                                    ${page.title}
                                </h3>
                                <p>${page.description}</p>
                            </div>
                            <div class="timeline-meta">
                                <div class="temp-badge ${temp.class}">
                                    <span class="material-symbols-rounded">${temp.icon}</span>
                                    ${temp.label}
                                </div>
                                <div class="date-badge">
                                    <span class="material-symbols-rounded">calendar_month</span>
                                    ${dateStr}
                                </div>
                                <button class="expand-btn" type="button">
                                    <span class="material-symbols-rounded">expand_more</span>
                                </button>
                            </div>
                        </div>
                        <div class="timeline-card-body">
                            <div class="timeline-card-inner">
                                <div class="topic-cluster">
                                    <div class="topic-cluster-title">
                                        <span class="material-symbols-rounded">sell</span>
                                        Topics & Tags
                                    </div>
                                    <div class="topic-pills">
                                        ${page.tags.map(tag => `
                                            <div class="topic-pill" onclick="filterByTopic('${tag}')">
                                                <span class="material-symbols-rounded">tag</span>
                                                ${tag}
                                            </div>
                                        `).join("")}
                                        <div class="topic-pill" onclick="filterByCategory('${page.category}')" style="background: rgba(102,163,255,.1); border-color: rgba(102,163,255,.2); color: var(--blue);">
                                            <span class="material-symbols-rounded">category</span>
                                            ${page.category}
                                        </div>
                                    </div>
                                </div>
                                ${related.length > 0 ? `
                                    <div class="related-pages">
                                        <div class="related-title">
                                            <span class="material-symbols-rounded">hub</span>
                                            Related Infographics
                                        </div>
                                        <div class="related-grid">
                                            ${related.map(r => `
                                                <a href="${r.href}" class="related-card">
                                                    <span class="material-symbols-rounded">${r.icon}</span>
                                                    <span>${r.title}</span>
                                                </a>
                                            `).join("")}
                                        </div>
                                    </div>
                                ` : ''}
                                <div class="timeline-actions">
                                    <a href="${page.href}" class="timeline-action-btn primary">
                                        <span class="material-symbols-rounded">open_in_new</span>
                                        Open Infographic
                                    </a>
                                    <button class="timeline-action-btn" onclick="showMindmap('${page.id}')">
                                        <span class="material-symbols-rounded">account_tree</span>
                                        Topic Map
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTimelineView(filtered) {
            const sorted = [...filtered].sort((a, b) => {
                if (a.created && b.created) return b.created - a.created;
                if (a.created) return -1;
                if (b.created) return 1;
                return a.order - b.order;
            });

            const topics = getAllTopics(filtered);

            return `
                <div class="temp-legend">
                    <div class="temp-legend-title">
                        <span class="material-symbols-rounded">thermostat</span>
                        Freshness
                    </div>
                    <div class="temp-legend-items">
                        <div class="temp-legend-item">
                            <div class="temp-legend-dot hot"></div>
                            <span>Fresh (7d)</span>
                        </div>
                        <div class="temp-legend-item">
                            <div class="temp-legend-dot warm"></div>
                            <span>Recent (30d)</span>
                        </div>
                        <div class="temp-legend-item">
                            <div class="temp-legend-dot mild"></div>
                            <span>Current (90d)</span>
                        </div>
                        <div class="temp-legend-item">
                            <div class="temp-legend-dot cool"></div>
                            <span>Settling (180d)</span>
                        </div>
                        <div class="temp-legend-item">
                            <div class="temp-legend-dot cold"></div>
                            <span>Archive (>180d)</span>
                        </div>
                    </div>
                </div>

                <div class="timeline-view">
                    ${sorted.map(page => renderTimelineCard(page, pages)).join("")}
                </div>
            `;
        }

        // Timeline interaction functions
        window.toggleTimelineCard = function(pageId) {
            const card = document.querySelector(`.timeline-card[data-page-id="${pageId}"]`);
            if (card) {
                card.classList.toggle('expanded');
            }
        };

        window.filterByTopic = function(topic) {
            document.getElementById('search').value = topic;
            searchQuery = topic;
            render();
        };

        window.filterByCategory = function(category) {
            activeCategory = category;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === category);
            });
            render();
        };

        // Reels content data - highlights for each infographic
        const reelsContent = {
            "2026_ai_strategy_comparison": {
                highlight: "2026",
                quote: "The AI landscape is shifting from capability race to strategic integration.",
                stats: [{ value: "5+", label: "Strategies" }, { value: "2026", label: "Horizon" }]
            },
            "2026-brain2": {
                highlight: "Neural",
                quote: "Understanding how AI mirrors and diverges from human cognition.",
                stats: [{ value: "", label: "Potential" }, { value: "2026", label: "Target" }]
            },
            "2026-predictions": {
                highlight: "2026",
                quote: "Bold predictions for the AI-transformed world ahead.",
                stats: [{ value: "10+", label: "Predictions" }, { value: "1yr", label: "Horizon" }]
            },
            "agents-domain-memory": {
                highlight: "Memory",
                quote: "Agents that remember context unlock persistent intelligence.",
                stats: [{ value: "", label: "Context" }, { value: "100%", label: "Recall" }]
            },
            "ai-factory-era": {
                highlight: "Factory",
                quote: "We're entering the era of AI as manufacturing infrastructure.",
                stats: [{ value: "10x", label: "Scale" }, { value: "24/7", label: "Output" }]
            },
            "ai-strategy": {
                highlight: "Strategy",
                quote: "Strategic frameworks for AI adoption and competitive advantage.",
                stats: [{ value: "5", label: "Pillars" }, { value: "ROI", label: "Focus" }]
            },
            "ai-strategy2": {
                highlight: "Evolved",
                quote: "Second-generation AI strategies for mature organizations.",
                stats: [{ value: "V2", label: "Version" }, { value: "Scale", label: "Focus" }]
            },
            "ai-talent-market": {
                highlight: "$500K+",
                quote: "Top AI talent commands unprecedented compensation packages.",
                stats: [{ value: "3x", label: "Demand" }, { value: "40%", label: "Salaries" }]
            },
            "claude": {
                highlight: "Claude",
                quote: "Anthropic's approach to building helpful, harmless, and honest AI.",
                stats: [{ value: "200K", label: "Context" }, { value: "Opus", label: "Model" }]
            },
            "good-4-ai": {
                highlight: "Ethics",
                quote: "Building AI that's genuinely good for humanity.",
                stats: [{ value: "100%", label: "Aligned" }, { value: "Safe", label: "Priority" }]
            },
            "google-vs-openai": {
                highlight: "Battle",
                quote: "The defining rivalry shaping AI's future direction.",
                stats: [{ value: "2", label: "Giants" }, { value: "$B+", label: "Stakes" }]
            },
            "llm-psy": {
                highlight: "Mind",
                quote: "The psychology of large language models and emergent behaviors.",
                stats: [{ value: "175B+", label: "Params" }, { value: "", label: "Layers" }]
            },
            "napoleon-technique": {
                highlight: "Napoleon",
                quote: "Strategic frameworks borrowed from military genius.",
                stats: [{ value: "6", label: "Tactics" }, { value: "Win", label: "Goal" }]
            },
            "personal-agents": {
                highlight: "Personal",
                quote: "AI assistants that truly understand and adapt to you.",
                stats: [{ value: "1:1", label: "Ratio" }, { value: "24/7", label: "Available" }]
            },
            "engineering-mode-trigger-levels": {
                highlight: "Levels",
                quote: "Understanding when to engage deep engineering focus.",
                stats: [{ value: "5", label: "Levels" }, { value: "Flow", label: "State" }]
            },
            "human-friction": {
                highlight: "Friction",
                quote: "Most productivity problems aren't lack of effort  they're local friction.",
                stats: [{ value: "6", label: "Roles" }, { value: "AI", label: "Solution" }]
            },
            "latent-demand-ai": {
                highlight: "Latent",
                quote: "Don't build for the model of today. Build for the model 6 months from now.",
                stats: [{ value: "6mo", label: "Horizon" }, { value: "Swarms", label: "Future" }]
            }
        };

        function getReelContent(page) {
            const id = page.id.toLowerCase().replace(/[^a-z0-9-_]/g, '');
            const content = reelsContent[id] || reelsContent[page.id] || {};
            return {
                highlight: content.highlight || page.title.split(' ')[0],
                quote: content.quote || page.description,
                stats: content.stats || [{ value: "", label: "Insights" }]
            };
        }

        // Decorative icons pool for random selection
        const decorativeIcons = [
            'auto_awesome', 'bolt', 'rocket_launch', 'lightbulb', 'trending_up',
            'psychology', 'hub', 'scatter_plot', 'insights', 'speed',
            'token', 'stars', 'flare', 'blur_on', 'grain',
            'diamond', 'hexagon', 'change_history', 'category', 'widgets'
        ];

        // Seeded random for consistent layouts per page
        function seededRandom(seed) {
            const x = Math.sin(seed) * 10000;
            return x - Math.floor(x);
        }

        function getLayoutVariant(index, pageId) {
            const seed = pageId.split('').reduce((a, c) => a + c.charCodeAt(0), 0) + index;
            return Math.floor(seededRandom(seed) * 5);
        }

        function getRandomIcons(pageId, count = 3) {
            const seed = pageId.split('').reduce((a, c) => a + c.charCodeAt(0), 0);
            const icons = [];
            for (let i = 0; i < count; i++) {
                const idx = Math.floor(seededRandom(seed + i * 7) * decorativeIcons.length);
                icons.push(decorativeIcons[idx]);
            }
            return icons;
        }

        function renderReelCard(page, index, total) {
            const temp = getTemperature(page);
            const content = getReelContent(page);
            const catMeta = categoryMeta[page.category] || { icon: "folder" };
            const variant = getLayoutVariant(index, page.id);
            const icons = getRandomIcons(page.id);

            const statsHtml = content.stats.map(s => `
                <div class="reel-stat">
                    <div class="reel-stat-value">${s.value}</div>
                    <div class="reel-stat-label">${s.label}</div>
                </div>
            `).join('');

            const decorativeHtml = `
                <div class="reel-deco reel-deco-1"><span class="material-symbols-rounded">${icons[0]}</span></div>
                <div class="reel-deco reel-deco-2"><span class="material-symbols-rounded">${icons[1]}</span></div>
                <div class="reel-deco reel-deco-3"><span class="material-symbols-rounded">${icons[2]}</span></div>
            `;

            // Layout variants
            const layouts = {
                // Variant 0: Classic centered
                0: `
                    <div class="reel-content layout-center">
                        <div class="reel-category">
                            <span class="material-symbols-rounded">${catMeta.icon}</span>
                            ${page.category}
                        </div>
                        <h2 class="reel-title">${page.title}</h2>
                        <div class="reel-highlight">${content.highlight}</div>
                        <div class="reel-quote">"${content.quote}"</div>
                        <div class="reel-stats">${statsHtml}</div>
                    </div>
                `,
                // Variant 1: Left-aligned with big icon
                1: `
                    <div class="reel-content layout-left">
                        <div class="reel-big-icon">
                            <span class="material-symbols-rounded">${catMeta.icon}</span>
                        </div>
                        <div class="reel-category">
                            <span class="material-symbols-rounded">${catMeta.icon}</span>
                            ${page.category}
                        </div>
                        <h2 class="reel-title">${page.title}</h2>
                        <div class="reel-quote">"${content.quote}"</div>
                        <div class="reel-highlight">${content.highlight}</div>
                        <div class="reel-stats">${statsHtml}</div>
                    </div>
                `,
                // Variant 2: Stats first, highlight bottom
                2: `
                    <div class="reel-content layout-stats-top">
                        <div class="reel-stats reel-stats-large">${statsHtml}</div>
                        <div class="reel-category">
                            <span class="material-symbols-rounded">${catMeta.icon}</span>
                            ${page.category}
                        </div>
                        <h2 class="reel-title">${page.title}</h2>
                        <div class="reel-quote">"${content.quote}"</div>
                        <div class="reel-highlight">${content.highlight}</div>
                    </div>
                `,
                // Variant 3: Right-aligned compact
                3: `
                    <div class="reel-content layout-right">
                        <h2 class="reel-title">${page.title}</h2>
                        <div class="reel-highlight">${content.highlight}</div>
                        <div class="reel-category">
                            <span class="material-symbols-rounded">${catMeta.icon}</span>
                            ${page.category}
                        </div>
                        <div class="reel-quote">"${content.quote}"</div>
                        <div class="reel-stats">${statsHtml}</div>
                    </div>
                `,
                // Variant 4: Split layout with icon column
                4: `
                    <div class="reel-content layout-split">
                        <div class="reel-split-icons">
                            <span class="material-symbols-rounded">${icons[0]}</span>
                            <span class="material-symbols-rounded">${icons[1]}</span>
                            <span class="material-symbols-rounded">${icons[2]}</span>
                        </div>
                        <div class="reel-split-content">
                            <div class="reel-category">
                                <span class="material-symbols-rounded">${catMeta.icon}</span>
                                ${page.category}
                            </div>
                            <h2 class="reel-title">${page.title}</h2>
                            <div class="reel-highlight">${content.highlight}</div>
                            <div class="reel-quote">"${content.quote}"</div>
                            <div class="reel-stats">${statsHtml}</div>
                                </div>
                    </div>
                `
            };

            return `
                <div class="reel-card layout-variant-${variant}" data-index="${index}" onclick="window.location.href='${page.href}'" style="cursor: pointer;">
                    <div class="reel-temp ${temp.class}">
                        <span class="material-symbols-rounded">${temp.icon}</span>
                        ${temp.label}
                    </div>
                    ${decorativeHtml}
                    ${layouts[variant]}
                </div>
            `;
        }

        function openReelsView(filtered, startIndex = 0) {
            const sorted = [...filtered].sort((a, b) => {
                if (a.created && b.created) return b.created - a.created;
                if (a.created) return -1;
                if (b.created) return 1;
                return a.order - b.order;
            });

            // Double the content for infinite scroll illusion
            const extendedPages = [...sorted, ...sorted, ...sorted];

            const container = document.createElement('div');
            container.className = 'reels-container';
            container.id = 'reelsContainer';
            container.innerHTML = `
                <button class="reels-close" onclick="closeReelsView()">
                    <span class="material-symbols-rounded">close</span>
                </button>
                <div class="reels-scroll" id="reelsScroll">
                    ${extendedPages.map((page, i) => renderReelCard(page, i % sorted.length, sorted.length)).join('')}
                </div>
                <div class="reels-hint" id="reelsHint">
                    <span class="material-symbols-rounded">swipe_up</span>
                    Swipe to explore
                </div>
                <div class="entropy-meter" id="entropyMeter">
                    <span class="material-symbols-rounded">bolt</span>
                    <div class="entropy-bar">
                        <div class="entropy-fill" id="entropyFill"></div>
                    </div>
                </div>
            `;

            document.body.appendChild(container);
            document.body.style.overflow = 'hidden';

            const scrollEl = document.getElementById('reelsScroll');
            const hintEl = document.getElementById('reelsHint');
            const entropyMeter = document.getElementById('entropyMeter');
            const entropyFill = document.getElementById('entropyFill');
            const totalOriginal = sorted.length;

            // Start in the middle set for infinite scroll
            const middleStart = totalOriginal + startIndex;
            const cardHeight = window.innerHeight;
            scrollEl.scrollTop = middleStart * cardHeight;

            let lastIndex = startIndex;
            let hideHintTimeout;

            // Entropy tracking
            let lastScrollTop = scrollEl.scrollTop;
            let lastScrollTime = Date.now();
            let currentEntropy = 0;
            let entropyDecayInterval;
            let entropyHideTimeout;

            function updateEntropy(speed) {
                // Calculate entropy based on scroll speed (pixels per ms)
                // Normal scroll: ~0.5-2 px/ms, fast scroll: 5+ px/ms
                const normalizedSpeed = Math.min(speed / 8, 1); // Cap at 1
                const targetEntropy = normalizedSpeed;

                // Smoothly increase entropy
                currentEntropy = Math.min(1, currentEntropy + (targetEntropy - currentEntropy) * 0.3);

                applyEntropy(currentEntropy);
            }

            function applyEntropy(entropy) {
                // Update CSS custom properties
                container.style.setProperty('--entropy', entropy.toFixed(3));
                container.style.setProperty('--entropy-scale', (1 + entropy * 0.3).toFixed(3));
                container.style.setProperty('--entropy-rotation', (entropy * 20) + 'deg');
                container.style.setProperty('--entropy-hue', (entropy * 60) + 'deg');

                // Update entropy level classes
                container.classList.remove('entropy-low', 'entropy-medium', 'entropy-high', 'entropy-extreme');
                entropyMeter.classList.remove('level-low', 'level-medium', 'level-high', 'level-extreme');

                let levelClass;
                if (entropy < 0.25) levelClass = 'low';
                else if (entropy < 0.5) levelClass = 'medium';
                else if (entropy < 0.75) levelClass = 'high';
                else levelClass = 'extreme';

                container.classList.add('entropy-' + levelClass);
                entropyMeter.classList.add('level-' + levelClass);

                // Update meter fill
                entropyFill.style.width = (entropy * 100) + '%';

                // Show meter when there's entropy
                if (entropy > 0.05) {
                    entropyMeter.classList.add('visible');
                    clearTimeout(entropyHideTimeout);
                    entropyHideTimeout = setTimeout(() => {
                        if (currentEntropy < 0.1) {
                            entropyMeter.classList.remove('visible');
                        }
                    }, 1500);
                }
            }

            // Decay entropy over time
            entropyDecayInterval = setInterval(() => {
                if (currentEntropy > 0) {
                    currentEntropy = Math.max(0, currentEntropy - 0.02);
                    applyEntropy(currentEntropy);
                }
            }, 50);
            window.reelsEntropyInterval = entropyDecayInterval;

            // Hide hint after first scroll
            hideHintTimeout = setTimeout(() => {
                if (hintEl) hintEl.style.opacity = '0';
            }, 3000);

            scrollEl.addEventListener('scroll', () => {
                const scrollTop = scrollEl.scrollTop;
                const currentCard = Math.round(scrollTop / cardHeight);
                const realIndex = currentCard % totalOriginal;
                const now = Date.now();

                // Calculate scroll speed
                const timeDelta = now - lastScrollTime;
                const scrollDelta = Math.abs(scrollTop - lastScrollTop);
                if (timeDelta > 0) {
                    const speed = scrollDelta / timeDelta; // pixels per ms
                    updateEntropy(speed);
                }
                lastScrollTop = scrollTop;
                lastScrollTime = now;

                // Update index and hide hint
                if (realIndex !== lastIndex) {
                    lastIndex = realIndex;

                    // Hide hint on first scroll
                    if (hintEl && hintEl.style.opacity !== '0') {
                        hintEl.style.opacity = '0';
                        clearTimeout(hideHintTimeout);
                    }
                }

                // Infinite scroll: jump when reaching edges
                if (currentCard < totalOriginal / 2) {
                    scrollEl.scrollTop = scrollTop + (totalOriginal * cardHeight);
                } else if (currentCard > totalOriginal * 2.5) {
                    scrollEl.scrollTop = scrollTop - (totalOriginal * cardHeight);
                }
            });

            // Keyboard navigation
            const keyHandler = (e) => {
                if (e.key === 'Escape') {
                    closeReelsView();
                } else if (e.key === 'ArrowDown' || e.key === ' ') {
                    e.preventDefault();
                    scrollEl.scrollBy({ top: cardHeight, behavior: 'smooth' });
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    scrollEl.scrollBy({ top: -cardHeight, behavior: 'smooth' });
                }
            };
            document.addEventListener('keydown', keyHandler);
            container.dataset.keyHandler = 'true';
            window.reelsKeyHandler = keyHandler;
        }

        window.closeReelsView = function() {
            const container = document.getElementById('reelsContainer');
            if (container) {
                container.remove();
                document.body.style.overflow = '';
                if (window.reelsKeyHandler) {
                    document.removeEventListener('keydown', window.reelsKeyHandler);
                }
                if (window.reelsEntropyInterval) {
                    clearInterval(window.reelsEntropyInterval);
                }
                // Reset view to folder
                currentView = 'folder';
                document.querySelectorAll('.view-btn').forEach(b => {
                    b.classList.toggle('active', b.dataset.view === 'folder');
                });
            }
        };

        window.showMindmap = function(pageId) {
            const page = pages.find(p => p.id === pageId);
            if (!page) return;

            const related = getRelatedPages(page, pages);
            const topics = page.tags;

            // Calculate positions for mindmap branches
            const centerX = 50;
            const centerY = 50;
            const radius = 35;

            let branchesHtml = '';
            const allItems = [
                ...topics.map(t => ({ type: 'topic', name: t })),
                ...related.slice(0, 4).map(r => ({ type: 'page', page: r }))
            ];

            allItems.forEach((item, i) => {
                const angle = (i / allItems.length) * 2 * Math.PI - Math.PI / 2;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                if (item.type === 'topic') {
                    const topicPages = pages.filter(p =>
                        p.tags.some(t => t.toLowerCase() === item.name.toLowerCase())
                    );
                    branchesHtml += `
                        <div class="mindmap-branch" style="left: ${x}%; top: ${y}%; transform: translate(-50%, -50%);" onclick="filterByTopic('${item.name}')">
                            <h4><span class="material-symbols-rounded" style="color: var(--vio);">tag</span> ${item.name}</h4>
                            <div class="count">${topicPages.length} infographic${topicPages.length !== 1 ? 's' : ''}</div>
                        </div>
                    `;
                } else {
                    branchesHtml += `
                        <a href="${item.page.href}" class="mindmap-branch" style="left: ${x}%; top: ${y}%; transform: translate(-50%, -50%);">
                            <h4><span class="material-symbols-rounded" style="color: var(--good);">${item.page.icon}</span> ${item.page.title.slice(0, 25)}${item.page.title.length > 25 ? '...' : ''}</h4>
                            <div class="count">${item.page.category}</div>
                        </a>
                    `;
                }
            });

            const modal = document.createElement('dialog');
            modal.innerHTML = `
                <div style="padding: 16px; border-bottom: 1px solid var(--stroke); display: flex; justify-content: space-between; align-items: center;">
                    <div style="font-weight: 600;">Topic Map: ${page.title.slice(0, 40)}${page.title.length > 40 ? '...' : ''}</div>
                    <button onclick="this.closest('dialog').close(); this.closest('dialog').remove();" style="background: none; border: 1px solid var(--stroke); border-radius: 8px; padding: 8px 12px; color: var(--text); cursor: pointer;">Close</button>
                </div>
                <div class="mindmap-container" style="height: 450px;">
                    <div class="mindmap-center" onclick="window.location.href='${page.href}'">
                        <span class="material-symbols-rounded">${page.icon}</span>
                        <span>Current</span>
                    </div>
                    ${branchesHtml}
                </div>
            `;
            modal.style.cssText = 'border: 1px solid var(--stroke); border-radius: 18px; padding: 0; background: linear-gradient(180deg, rgba(15,26,51,.95), rgba(11,18,34,.98)); color: var(--text); width: min(900px, 94vw); box-shadow: var(--shadow);';
            document.body.appendChild(modal);
            modal.showModal();

            modal.addEventListener('click', (e) => {
                const rect = modal.getBoundingClientRect();
                if (e.clientX < rect.left || e.clientX > rect.right || e.clientY < rect.top || e.clientY > rect.bottom) {
                    modal.close();
                    modal.remove();
                }
            });
        };

        function renderFolderCard(folder) {
            const imageHtml = folder.image
                ? `<div class="folder-preview">
                       <img src="${folder.image}" alt="${folder.name} preview" loading="lazy">
                       <div class="folder-preview-overlay"></div>
                   </div>`
                : '';

            // Generate search match snippet if searching
            let searchMatchHtml = '';
            if (searchQuery.trim() && folder.textContent) {
                const snippet = getSearchSnippet(folder.textContent, searchQuery.trim());
                if (snippet) {
                    searchMatchHtml = `<div class="search-match">${snippet}</div>`;
                }
            }

            return `
                <a href="${folder.path}" class="folder-card">
                    ${imageHtml}
                    <div class="folder-content">
                        <div class="folder-header">
                            <div class="folder-icon">
                                <span class="material-symbols-rounded" aria-hidden="true">${folder.icon}</span>
                            </div>
                            <h3>${folder.name}</h3>
                        </div>
                        <p class="folder-desc">${folder.description}</p>
                        ${searchMatchHtml}
                        <div class="folder-meta">
                            <div class="folder-stat">
                                <span class="material-symbols-rounded">description</span>
                                ${folder.fileCount} files
                            </div>
                        </div>
                        <div class="folder-tags">
                            ${folder.tags.map(t => `<span class="tag">${t}</span>`).join("")}
                        </div>
                    </div>
                </a>
            `;
        }

        function filterFolders() {
            const query = searchQuery.toLowerCase().trim();
            if (!query) return folders;

            return folders.filter(folder => {
                const searchable = [
                    folder.name,
                    folder.description,
                    ...folder.tags,
                    folder.textContent || ""
                ].join(" ").toLowerCase();
                return searchable.includes(query);
            });
        }

        function renderFolderView(filtered) {
            const filteredFolders = filterFolders();
            const sorted = [...filtered].sort((a, b) => {
                if (a.created && b.created) return b.created - a.created;
                if (a.created) return -1;
                if (b.created) return 1;
                return a.order - b.order;
            });

            let html = '';

            // Render folders section if there are folders
            if (filteredFolders.length > 0) {
                html += `
                    <section class="folders-section">
                        <div class="section-header">
                            <span class="material-symbols-rounded" aria-hidden="true">folder_special</span>
                            <h2 class="section-title">Collections</h2>
                            <span class="category-count">${filteredFolders.length}</span>
                        </div>
                        <div class="folders-grid">
                            ${filteredFolders.map(f => renderFolderCard(f)).join("")}
                        </div>
                    </section>
                `;
            }

            // Render pages section
            if (sorted.length > 0) {
                html += `
                    <section class="category">
                        <div class="category-header">
                            <span class="material-symbols-rounded" aria-hidden="true">description</span>
                            <h2 class="category-title">Pages</h2>
                            <span class="category-count">${sorted.length}</span>
                        </div>
                        <div class="pages-grid">
                            ${sorted.map(p => renderCard(p, { showDate: true, showCategoryBadge: true })).join("")}
                        </div>
                    </section>
                `;
            }

            return html;
        }

        function render() {
            const content = document.getElementById("content");
            const filtered = filterPages();
            const filteredFolders = filterFolders();

            if (filtered.length === 0 && filteredFolders.length === 0) {
                content.innerHTML = `
                    <div class="empty-state">
                        <h3>No pages found</h3>
                        <p>Try adjusting your search or filter criteria</p>
                    </div>
                `;
                return;
            }

            switch (currentView) {
                case "folder":
                    content.innerHTML = renderFolderView(filtered);
                    break;
                case "reels":
                    // Reels opens as overlay, show folder view behind
                    content.innerHTML = renderFolderView(filtered);
                    openReelsView(filtered);
                    break;
                case "timeline":
                    content.innerHTML = renderTimelineView(filtered);
                    break;
                case "date":
                    content.innerHTML = renderDateView(filtered);
                    break;
                case "grid":
                    content.innerHTML = renderGridView(filtered);
                    break;
                case "category":
                default:
                    content.innerHTML = renderCategoryView(filtered);
                    break;
            }
        }

        // Event handlers
        document.getElementById("search").addEventListener("input", (e) => {
            searchQuery = e.target.value;
            render();
        });

        document.getElementById("filters").addEventListener("click", (e) => {
            if (e.target.classList.contains("filter-btn")) {
                document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
                e.target.classList.add("active");
                activeCategory = e.target.dataset.category;
                render();
            }
        });

        document.addEventListener("keydown", (e) => {
            if (e.key === "/" && document.activeElement.tagName !== "INPUT") {
                e.preventDefault();
                document.getElementById("search").focus();
            }
        });

        document.getElementById("viewSwitcher").addEventListener("click", (e) => {
            const btn = e.target.closest(".view-btn");
            if (btn) {
                // Close reels if open and switching to different view
                if (currentView === 'reels' && btn.dataset.view !== 'reels') {
                    closeReelsView();
                }
                document.querySelectorAll(".view-btn").forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                currentView = btn.dataset.view;
                render();
            }
        });

        // Initialize
        loadPages();
    </script>
</body>
</html>
